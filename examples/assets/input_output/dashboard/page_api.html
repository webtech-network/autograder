<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Operations - Autograder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="page-container">
        <header class="page-header">
            <h1>üîß API Operations</h1>
            <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>
        </header>

        <div class="page-content">
            <div class="grid-sidebar">
                <!-- Left: Operations -->
                <div>
                    <!-- System Health -->
                    <div class="panel mb-3">
                        <div class="panel-header">System Health</div>
                        <div class="panel-content">
                            <button onclick="healthCheck()">
                                <span class="method-badge method-get">GET</span>
                                /api/v1/health
                            </button>
                            <button onclick="readyCheck()">
                                <span class="method-badge method-get">GET</span>
                                /api/v1/ready
                            </button>
                        </div>
                    </div>

                    <!-- Templates -->
                    <div class="panel mb-3">
                        <div class="panel-header">Templates</div>
                        <div class="panel-content">
                            <button onclick="listTemplates()">
                                <span class="method-badge method-get">GET</span>
                                /api/v1/templates
                            </button>

                            <label>Template Name</label>
                            <div class="button-group">
                                <input type="text" id="templateName" value="input_output" style="margin-bottom: 0;">
                                <button style="width: auto;" onclick="getTemplate()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Configurations -->
                    <div class="panel mb-3">
                        <div class="panel-header">Configurations</div>
                        <div class="panel-content">
                            <button onclick="listConfigs()">
                                <span class="method-badge method-get">GET</span>
                                /api/v1/configs
                            </button>

                            <label>Assignment ID</label>
                            <div class="button-group mb-2">
                                <input type="text" id="configAssignmentId" value="io-calc-001" style="margin-bottom: 0;">
                                <button style="width: auto;" onclick="getConfig()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>

                            <label>Config ID (for update)</label>
                            <div class="button-group">
                                <input type="number" id="configId" value="1" style="margin-bottom: 0;">
                                <button class="warning" style="width: auto;" onclick="updateConfig()">
                                    <span class="method-badge method-put">PUT</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Submissions -->
                    <div class="panel">
                        <div class="panel-header">Submissions</div>
                        <div class="panel-content">
                            <label>Submission ID</label>
                            <div class="button-group mb-2">
                                <input type="number" id="submissionId" value="1" style="margin-bottom: 0;">
                                <button style="width: auto;" onclick="getSubmission()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>

                            <label>User ID (list submissions)</label>
                            <div class="button-group">
                                <input type="text" id="userId" value="user_001" style="margin-bottom: 0;">
                                <button style="width: auto;" onclick="getUserSubmissions()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Response -->
                <div class="panel">
                    <div class="panel-header">API Response</div>
                    <div class="panel-content">
                        <div id="responseInfo" class="response-info mb-2">
                            <span class="status-code">---</span>
                            <span class="response-time">---</span>
                        </div>
                        <div class="json-box" id="apiResponse" style="min-height: 500px;">
                            Click an operation to see the response...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="shared.js?v=2"></script>
    <script>
        function displayResponse(result) {
            const infoDiv = document.getElementById('responseInfo');
            infoDiv.innerHTML = `
                <span class="status-code ${result.ok ? 'success' : 'error'}">${result.status || 'ERR'}</span>
                <span class="response-time">${result.duration}ms</span>
            `;

            document.getElementById('apiResponse').textContent = JSON.stringify(result.data, null, 2);
        }

        async function healthCheck() {
            displayResponse(await apiCall('/api/v1/health'));
        }

        async function readyCheck() {
            displayResponse(await apiCall('/api/v1/ready'));
        }

        async function listTemplates() {
            displayResponse(await apiCall('/api/v1/templates'));
        }

        async function getTemplate() {
            const name = document.getElementById('templateName').value;
            displayResponse(await apiCall(`/api/v1/templates/${name}`));
        }

        async function listConfigs() {
            displayResponse(await apiCall('/api/v1/configs'));
        }

        async function getConfig() {
            const id = document.getElementById('configAssignmentId').value;
            displayResponse(await apiCall(`/api/v1/configs/${id}`));
        }

        async function updateConfig() {
            const id = document.getElementById('configId').value;
            displayResponse(await apiCall(`/api/v1/configs/${id}`, 'PUT', { is_active: true }));
        }

        async function getSubmission() {
            const id = document.getElementById('submissionId').value;
            displayResponse(await apiCall(`/api/v1/submissions/${id}`));
        }

        async function getUserSubmissions() {
            const userId = document.getElementById('userId').value;
            displayResponse(await apiCall(`/api/v1/submissions/user/${userId}`));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadApiUrl);
    </script>
</body>
</html>

