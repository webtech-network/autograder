<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autograder Testing Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-dark: #1e1e2e;
            --bg-card: #282a36;
            --text-primary: #f8f8f2;
            --text-secondary: #6272a4;
        }

        body {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: var(--text-primary);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .navbar-custom {
            background: rgba(30, 30, 46, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tabs .nav-link {
            color: var(--text-secondary);
            border: none;
            padding: 1rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            color: var(--text-primary);
            border: none;
        }

        .nav-tabs .nav-link.active {
            background: transparent;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .card-custom {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-success-custom {
            background: linear-gradient(135deg, var(--success-color), #059669);
            border: none;
        }

        .btn-warning-custom {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            border: none;
        }

        .btn-danger-custom {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            border: none;
        }

        .form-control-custom, .form-select-custom {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 0.75rem 1rem;
        }

        .form-control-custom:focus, .form-select-custom:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-color);
            color: var(--text-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .form-select-custom option {
            background: var(--bg-dark);
            color: var(--text-primary);
        }

        .code-editor {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            background: #1e1e2e;
            border-radius: 8px;
            min-height: 300px;
        }

        .json-viewer {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 13px;
            background: #1e1e2e;
            border-radius: 8px;
            max-height: 400px;
            overflow: auto;
        }

        .criteria-tree-visual {
            font-family: 'Fira Code', monospace;
            font-size: 12px;
        }

        .tree-node {
            padding: 0.25rem 0;
        }

        .tree-base { color: #50fa7b; }
        .tree-bonus { color: #f1fa8c; }
        .tree-penalty { color: #ff5555; }
        .tree-subject { color: #8be9fd; }
        .tree-test { color: #bd93f9; }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-pending { background: rgba(245, 158, 11, 0.2); color: var(--warning-color); }
        .status-processing { background: rgba(99, 102, 241, 0.2); color: var(--primary-color); }
        .status-completed { background: rgba(16, 185, 129, 0.2); color: var(--success-color); }
        .status-failed { background: rgba(239, 68, 68, 0.2); color: var(--danger-color); }

        .score-display {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .response-panel {
            background: #1e1e2e;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-content-area {
            min-height: 600px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .icon-box {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .loading-spinner {
            display: none;
        }

        .loading .loading-spinner {
            display: inline-block;
        }

        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1050;
        }

        .result-tree-node {
            border-left: 2px solid rgba(255, 255, 255, 0.1);
            margin-left: 1rem;
            padding-left: 1rem;
        }

        .api-endpoint {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
        }

        .method-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .method-get { background: #10b981; }
        .method-post { background: #3b82f6; }
        .method-put { background: #f59e0b; }
        .method-delete { background: #ef4444; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
        <div class="container">
            <a class="navbar-brand text-white fw-bold" href="#">
                <i class="bi bi-mortarboard-fill me-2"></i>Autograder Testing Dashboard
            </a>
            <div class="d-flex align-items-center">
                <span class="badge bg-success me-3">
                    <i class="bi bi-circle-fill me-1" style="font-size: 0.5rem;"></i>
                    API: <span id="api-status">Checking...</span>
                </span>
                <input type="text" class="form-control form-control-custom" id="api-url"
                       value="http://localhost:8000" style="width: 250px;" placeholder="API Base URL">
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5">
        <!-- Main Tabs -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button">
                    <i class="bi bi-gear me-2"></i>Create Configuration
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="submit-tab" data-bs-toggle="tab" data-bs-target="#submit" type="button">
                    <i class="bi bi-upload me-2"></i>Submit Code
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="results-tab" data-bs-toggle="tab" data-bs-target="#results" type="button">
                    <i class="bi bi-graph-up me-2"></i>View Results
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="crud-tab" data-bs-toggle="tab" data-bs-target="#crud" type="button">
                    <i class="bi bi-database me-2"></i>CRUD Operations
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="docs-tab" data-bs-toggle="tab" data-bs-target="#docs" type="button">
                    <i class="bi bi-book me-2"></i>Documentation
                </button>
            </li>
        </ul>

        <div class="tab-content tab-content-area" id="mainTabsContent">
            <!-- Configuration Tab -->
            <div class="tab-pane fade show active" id="config" role="tabpanel">
                <div class="row">
                    <div class="col-lg-5">
                        <div class="card card-custom p-4 mb-4">
                            <h5 class="mb-4">
                                <i class="bi bi-sliders me-2 text-primary"></i>Configuration Options
                            </h5>

                            <div class="mb-3">
                                <label class="form-label">External Assignment ID</label>
                                <input type="text" class="form-control form-control-custom" id="config-assignment-id"
                                       placeholder="e.g., assignment-001" value="io-test-001">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Criteria Tree Template</label>
                                <select class="form-select form-select-custom" id="criteria-template">
                                    <option value="1">1 - Base Tests Only (Simple)</option>
                                    <option value="2">2 - Base + Bonus Tests</option>
                                    <option value="3">3 - Base + Bonus + Penalty Tests</option>
                                    <option value="4">4 - With Subjects (Organized)</option>
                                    <option value="5" selected>5 - Nested Subjects (Complex)</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Programming Language</label>
                                <select class="form-select form-select-custom" id="config-language">
                                    <option value="python" selected>Python</option>
                                    <option value="java">Java</option>
                                    <option value="javascript">JavaScript (Node.js)</option>
                                    <option value="cpp">C++</option>
                                </select>
                            </div>

                            <button class="btn btn-primary-custom w-100" onclick="createConfiguration()">
                                <span class="loading-spinner spinner-border spinner-border-sm me-2"></span>
                                <i class="bi bi-plus-circle me-2"></i>Create Configuration
                            </button>
                        </div>

                        <!-- Tree Visualization -->
                        <div class="card card-custom p-4">
                            <h6 class="mb-3">
                                <i class="bi bi-diagram-3 me-2"></i>Criteria Tree Structure
                            </h6>
                            <div id="tree-visualization" class="criteria-tree-visual p-3 bg-dark rounded">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-7">
                        <div class="card card-custom p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">
                                    <i class="bi bi-code-square me-2 text-warning"></i>Criteria JSON
                                </h5>
                                <div>
                                    <button class="btn btn-sm btn-outline-light me-2" onclick="copyToClipboard('criteria-json')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-light" onclick="formatJSON()">
                                        <i class="bi bi-braces"></i> Format
                                    </button>
                                </div>
                            </div>
                            <textarea id="criteria-json" class="form-control code-editor" rows="20"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card card-custom p-4">
                            <h6 class="mb-3">
                                <i class="bi bi-terminal me-2"></i>API Response
                            </h6>
                            <div id="config-response" class="response-panel p-3">
                                <pre class="text-muted mb-0">Response will appear here...</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Tab -->
            <div class="tab-pane fade" id="submit" role="tabpanel">
                <div class="row">
                    <div class="col-lg-5">
                        <div class="card card-custom p-4 mb-4">
                            <h5 class="mb-4">
                                <i class="bi bi-person me-2 text-info"></i>Submission Details
                            </h5>

                            <div class="mb-3">
                                <label class="form-label">Assignment ID</label>
                                <input type="text" class="form-control form-control-custom" id="submit-assignment-id"
                                       placeholder="Assignment ID to grade against" value="io-test-001">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Username</label>
                                <input type="text" class="form-control form-control-custom" id="submit-username"
                                       placeholder="Student username" value="student_test">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">User ID</label>
                                <input type="text" class="form-control form-control-custom" id="submit-user-id"
                                       placeholder="External user ID" value="user_001">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Programming Language</label>
                                <select class="form-select form-select-custom" id="submit-language" onchange="loadCodeExample()">
                                    <option value="python" selected>Python</option>
                                    <option value="java">Java</option>
                                    <option value="javascript">JavaScript (Node.js)</option>
                                    <option value="cpp">C++</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Code Example</label>
                                <select class="form-select form-select-custom" id="code-example" onchange="loadCodeExample()">
                                    <option value="simple">Simple Calculator (Correct)</option>
                                    <option value="advanced">Advanced Calculator (Full)</option>
                                    <option value="broken">Broken Calculator (Has Bugs)</option>
                                    <option value="custom">Custom Code</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Filename</label>
                                <input type="text" class="form-control form-control-custom" id="submit-filename"
                                       value="calculator.py">
                            </div>

                            <button class="btn btn-success-custom w-100" onclick="submitCode()">
                                <span class="loading-spinner spinner-border spinner-border-sm me-2"></span>
                                <i class="bi bi-send me-2"></i>Submit for Grading
                            </button>
                        </div>
                    </div>

                    <div class="col-lg-7">
                        <div class="card card-custom p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">
                                    <i class="bi bi-file-code me-2 text-success"></i>Source Code
                                </h5>
                                <button class="btn btn-sm btn-outline-light" onclick="copyToClipboard('source-code')">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                            <textarea id="source-code" class="form-control code-editor" rows="20"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card card-custom p-4">
                            <h6 class="mb-3">
                                <i class="bi bi-terminal me-2"></i>Submission Response
                            </h6>
                            <div id="submit-response" class="response-panel p-3">
                                <pre class="text-muted mb-0">Response will appear here...</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Tab -->
            <div class="tab-pane fade" id="results" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card card-custom p-4 mb-4">
                            <h5 class="mb-4">
                                <i class="bi bi-search me-2 text-warning"></i>Find Submission
                            </h5>

                            <div class="mb-3">
                                <label class="form-label">Submission ID</label>
                                <input type="number" class="form-control form-control-custom" id="result-submission-id"
                                       placeholder="Enter submission ID" value="1">
                            </div>

                            <button class="btn btn-warning-custom w-100 mb-3" onclick="getSubmissionResult()">
                                <span class="loading-spinner spinner-border spinner-border-sm me-2"></span>
                                <i class="bi bi-search me-2"></i>Get Result
                            </button>

                            <hr class="border-secondary">

                            <div class="mb-3">
                                <label class="form-label">User ID (for listing)</label>
                                <input type="text" class="form-control form-control-custom" id="result-user-id"
                                       placeholder="External user ID" value="user_001">
                            </div>

                            <button class="btn btn-outline-light w-100" onclick="getUserSubmissions()">
                                <i class="bi bi-list-ul me-2"></i>List User Submissions
                            </button>
                        </div>

                        <!-- Recent Submissions -->
                        <div class="card card-custom p-4">
                            <h6 class="mb-3">
                                <i class="bi bi-clock-history me-2"></i>Recent Submissions
                            </h6>
                            <div id="recent-submissions" class="list-group list-group-flush">
                                <div class="text-muted small">No submissions loaded</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="card card-custom p-4">
                            <h5 class="mb-4">
                                <i class="bi bi-clipboard-data me-2 text-success"></i>Grading Result
                            </h5>

                            <div id="result-display">
                                <div class="text-center text-muted py-5">
                                    <i class="bi bi-inbox display-1"></i>
                                    <p class="mt-3">Select a submission to view results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CRUD Tab -->
            <div class="tab-pane fade" id="crud" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card card-custom p-4 mb-4">
                            <h5 class="mb-4">
                                <i class="bi bi-database me-2 text-info"></i>API Operations
                            </h5>

                            <!-- Configurations -->
                            <h6 class="text-muted mb-3">Grading Configurations</h6>

                            <button class="btn btn-outline-primary w-100 mb-2" onclick="listConfigurations()">
                                <span class="method-badge method-get me-2">GET</span>
                                List All Configs
                            </button>

                            <div class="input-group mb-2">
                                <input type="text" class="form-control form-control-custom" id="crud-config-id"
                                       placeholder="Assignment ID">
                                <button class="btn btn-outline-info" onclick="getConfiguration()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>

                            <div class="input-group mb-3">
                                <input type="number" class="form-control form-control-custom" id="crud-config-delete-id"
                                       placeholder="Config ID to update">
                                <button class="btn btn-outline-warning" onclick="updateConfiguration()">
                                    <span class="method-badge method-put">PUT</span>
                                </button>
                            </div>

                            <hr class="border-secondary">

                            <!-- Submissions -->
                            <h6 class="text-muted mb-3">Submissions</h6>

                            <div class="input-group mb-2">
                                <input type="number" class="form-control form-control-custom" id="crud-submission-id"
                                       placeholder="Submission ID">
                                <button class="btn btn-outline-success" onclick="getSubmission()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>

                            <div class="input-group mb-3">
                                <input type="text" class="form-control form-control-custom" id="crud-user-submissions"
                                       placeholder="User ID">
                                <button class="btn btn-outline-info" onclick="listUserSubmissionsCrud()">
                                    <span class="method-badge method-get">GET</span>
                                </button>
                            </div>

                            <hr class="border-secondary">

                            <!-- System -->
                            <h6 class="text-muted mb-3">System</h6>

                            <button class="btn btn-outline-success w-100 mb-2" onclick="healthCheck()">
                                <span class="method-badge method-get me-2">GET</span>
                                Health Check
                            </button>

                            <button class="btn btn-outline-info w-100 mb-2" onclick="readinessCheck()">
                                <span class="method-badge method-get me-2">GET</span>
                                Readiness Check
                            </button>

                            <button class="btn btn-outline-warning w-100" onclick="listTemplates()">
                                <span class="method-badge method-get me-2">GET</span>
                                List Templates
                            </button>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="card card-custom p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">
                                    <i class="bi bi-terminal me-2"></i>API Response
                                </h5>
                                <div>
                                    <span id="response-status" class="badge bg-secondary me-2">-</span>
                                    <span id="response-time" class="badge bg-dark">-</span>
                                </div>
                            </div>
                            <div id="crud-response" class="response-panel p-3" style="min-height: 500px;">
                                <pre class="text-muted mb-0">API response will appear here...</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Tab -->
            <div class="tab-pane fade" id="docs" role="tabpanel">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <div class="card card-custom p-5">
                            <h3 class="mb-4">
                                <i class="bi bi-book me-2 text-primary"></i>Autograder I/O Template Guide
                            </h3>

                            <h5 class="mt-4 mb-3">Overview</h5>
                            <p class="text-secondary">
                                The Input/Output (I/O) template is designed for grading command-line programs that read from
                                stdin and write to stdout. It's perfect for testing algorithms, data processing programs,
                                and console applications.
                            </p>

                            <h5 class="mt-4 mb-3">Available Tests</h5>
                            <div class="table-responsive">
                                <table class="table table-dark table-hover">
                                    <thead>
                                        <tr>
                                            <th>Test Name</th>
                                            <th>Description</th>
                                            <th>Parameters</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>expect_output</code></td>
                                            <td>Run program with inputs and check output</td>
                                            <td>inputs, expected_output, program_command</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <h5 class="mt-4 mb-3">Criteria Tree Variations</h5>

                            <div class="accordion" id="criteriaAccordion">
                                <div class="accordion-item bg-transparent border-secondary">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button bg-dark text-white" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapse1">
                                            1. Base Tests Only (Simple)
                                        </button>
                                    </h2>
                                    <div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#criteriaAccordion">
                                        <div class="accordion-body bg-dark text-secondary">
                                            <p>The simplest configuration with only base tests. All tests contribute equally to the final score.</p>
                                            <ul>
                                                <li>No bonus or penalty categories</li>
                                                <li>No subject grouping</li>
                                                <li>Direct tests under base category</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item bg-transparent border-secondary">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed bg-dark text-white" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapse2">
                                            2. Base + Bonus Tests
                                        </button>
                                    </h2>
                                    <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#criteriaAccordion">
                                        <div class="accordion-body bg-dark text-secondary">
                                            <p>Adds bonus points for extra features. Students can score above 100%.</p>
                                            <ul>
                                                <li>Base category (weight: 100)</li>
                                                <li>Bonus category (weight: 15) - adds extra points</li>
                                                <li>Final score = base_score + bonus_score</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item bg-transparent border-secondary">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed bg-dark text-white" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapse3">
                                            3. Base + Bonus + Penalty Tests
                                        </button>
                                    </h2>
                                    <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#criteriaAccordion">
                                        <div class="accordion-body bg-dark text-secondary">
                                            <p>Full category support including penalties for errors or missing requirements.</p>
                                            <ul>
                                                <li>Base category (weight: 100)</li>
                                                <li>Bonus category (weight: 15)</li>
                                                <li>Penalty category (weight: 20) - deducts points</li>
                                                <li>Final score = base_score + bonus_score - penalty_score</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item bg-transparent border-secondary">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed bg-dark text-white" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapse4">
                                            4. With Subjects (Organized)
                                        </button>
                                    </h2>
                                    <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#criteriaAccordion">
                                        <div class="accordion-body bg-dark text-secondary">
                                            <p>Groups tests into subjects with individual weights.</p>
                                            <ul>
                                                <li>Subjects organize related tests</li>
                                                <li>Each subject has a weight (must sum to 100)</li>
                                                <li>Tests within subjects are weighted independently</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item bg-transparent border-secondary">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed bg-dark text-white" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#collapse5">
                                            5. Nested Subjects (Complex)
                                        </button>
                                    </h2>
                                    <div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#criteriaAccordion">
                                        <div class="accordion-body bg-dark text-secondary">
                                            <p>Full hierarchical structure with nested subjects for complex rubrics.</p>
                                            <ul>
                                                <li>Multiple levels of subject nesting</li>
                                                <li>Weights cascade through hierarchy</li>
                                                <li>Supports all three categories (base, bonus, penalty)</li>
                                                <li>Ideal for complex assignments with many requirements</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <h5 class="mt-4 mb-3">API Endpoints</h5>
                            <div class="list-group">
                                <div class="list-group-item bg-dark border-secondary">
                                    <div class="d-flex align-items-center">
                                        <span class="method-badge method-post me-3">POST</span>
                                        <code class="api-endpoint">/api/v1/configs</code>
                                        <span class="ms-3 text-secondary">Create grading configuration</span>
                                    </div>
                                </div>
                                <div class="list-group-item bg-dark border-secondary">
                                    <div class="d-flex align-items-center">
                                        <span class="method-badge method-get me-3">GET</span>
                                        <code class="api-endpoint">/api/v1/configs/{id}</code>
                                        <span class="ms-3 text-secondary">Get configuration by ID</span>
                                    </div>
                                </div>
                                <div class="list-group-item bg-dark border-secondary">
                                    <div class="d-flex align-items-center">
                                        <span class="method-badge method-post me-3">POST</span>
                                        <code class="api-endpoint">/api/v1/submissions</code>
                                        <span class="ms-3 text-secondary">Submit code for grading</span>
                                    </div>
                                </div>
                                <div class="list-group-item bg-dark border-secondary">
                                    <div class="d-flex align-items-center">
                                        <span class="method-badge method-get me-3">GET</span>
                                        <code class="api-endpoint">/api/v1/submissions/{id}</code>
                                        <span class="ms-3 text-secondary">Get submission with results</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ===============================================
        // Data: Criteria Templates
        // ===============================================
        const criteriaTemplates = {
            "1": {
                "test_library": "input_output",
                "base": {
                    "weight": 100,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["5", "3"]},
                                {"name": "expected_output", "value": "8"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["10", "4"]},
                                {"name": "expected_output", "value": "14"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                }
            },
            "2": {
                "test_library": "input_output",
                "base": {
                    "weight": 100,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["5", "3"]},
                                {"name": "expected_output", "value": "8"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["10", "4"]},
                                {"name": "expected_output", "value": "14"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["0", "0"]},
                                {"name": "expected_output", "value": "0"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                },
                "bonus": {
                    "weight": 15,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["-5", "10"]},
                                {"name": "expected_output", "value": "5"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["100", "200"]},
                                {"name": "expected_output", "value": "300"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                }
            },
            "3": {
                "test_library": "input_output",
                "base": {
                    "weight": 100,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["5", "3"]},
                                {"name": "expected_output", "value": "8"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["10", "4"]},
                                {"name": "expected_output", "value": "14"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["0", "0"]},
                                {"name": "expected_output", "value": "0"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                },
                "bonus": {
                    "weight": 15,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["-5", "10"]},
                                {"name": "expected_output", "value": "5"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                },
                "penalty": {
                    "weight": 20,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["abc", "xyz"]},
                                {"name": "expected_output", "value": "Error: Invalid input"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                }
            },
            "4": {
                "test_library": "input_output",
                "base": {
                    "weight": 100,
                    "subjects": [
                        {
                            "subject_name": "Addition",
                            "weight": 50,
                            "tests": [
                                {
                                    "name": "expect_output",
                                    "parameters": [
                                        {"name": "inputs", "value": ["add", "5", "3"]},
                                        {"name": "expected_output", "value": "8"},
                                        {"name": "program_command", "value": "python3 calculator.py"}
                                    ]
                                },
                                {
                                    "name": "expect_output",
                                    "parameters": [
                                        {"name": "inputs", "value": ["add", "0", "0"]},
                                        {"name": "expected_output", "value": "0"},
                                        {"name": "program_command", "value": "python3 calculator.py"}
                                    ]
                                }
                            ]
                        },
                        {
                            "subject_name": "Subtraction",
                            "weight": 50,
                            "tests": [
                                {
                                    "name": "expect_output",
                                    "parameters": [
                                        {"name": "inputs", "value": ["subtract", "10", "4"]},
                                        {"name": "expected_output", "value": "6"},
                                        {"name": "program_command", "value": "python3 calculator.py"}
                                    ]
                                },
                                {
                                    "name": "expect_output",
                                    "parameters": [
                                        {"name": "inputs", "value": ["subtract", "5", "10"]},
                                        {"name": "expected_output", "value": "-5"},
                                        {"name": "program_command", "value": "python3 calculator.py"}
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "bonus": {
                    "weight": 15,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["multiply", "6", "7"]},
                                {"name": "expected_output", "value": "42"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                },
                "penalty": {
                    "weight": 10,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["invalid_op", "5", "3"]},
                                {"name": "expected_output", "value": "Error: Unknown operation"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                }
            },
            "5": {
                "test_library": "input_output",
                "base": {
                    "weight": 100,
                    "subjects": [
                        {
                            "subject_name": "Basic Operations",
                            "weight": 60,
                            "subjects": [
                                {
                                    "subject_name": "Addition",
                                    "weight": 50,
                                    "tests": [
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["add", "5", "3"]},
                                                {"name": "expected_output", "value": "8"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["add", "0", "0"]},
                                                {"name": "expected_output", "value": "0"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["add", "-5", "10"]},
                                                {"name": "expected_output", "value": "5"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "subject_name": "Subtraction",
                                    "weight": 50,
                                    "tests": [
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["subtract", "10", "4"]},
                                                {"name": "expected_output", "value": "6"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["subtract", "5", "10"]},
                                                {"name": "expected_output", "value": "-5"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["subtract", "0", "0"]},
                                                {"name": "expected_output", "value": "0"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "subject_name": "Advanced Operations",
                            "weight": 40,
                            "subjects": [
                                {
                                    "subject_name": "Multiplication",
                                    "weight": 50,
                                    "tests": [
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["multiply", "6", "7"]},
                                                {"name": "expected_output", "value": "42"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["multiply", "0", "100"]},
                                                {"name": "expected_output", "value": "0"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["multiply", "-3", "4"]},
                                                {"name": "expected_output", "value": "-12"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "subject_name": "Division",
                                    "weight": 50,
                                    "tests": [
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["divide", "20", "5"]},
                                                {"name": "expected_output", "value": "4"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["divide", "10", "3"]},
                                                {"name": "expected_output", "value": "3"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        },
                                        {
                                            "name": "expect_output",
                                            "parameters": [
                                                {"name": "inputs", "value": ["divide", "0", "5"]},
                                                {"name": "expected_output", "value": "0"},
                                                {"name": "program_command", "value": "python3 calculator.py"}
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "bonus": {
                    "weight": 20,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["power", "2", "8"]},
                                {"name": "expected_output", "value": "256"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["modulo", "17", "5"]},
                                {"name": "expected_output", "value": "2"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["sqrt", "16"]},
                                {"name": "expected_output", "value": "4"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                },
                "penalty": {
                    "weight": 15,
                    "tests": [
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["divide", "10", "0"]},
                                {"name": "expected_output", "value": "Error: Division by zero"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["invalid_op", "5", "3"]},
                                {"name": "expected_output", "value": "Error: Unknown operation"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        },
                        {
                            "name": "expect_output",
                            "parameters": [
                                {"name": "inputs", "value": ["add", "abc", "xyz"]},
                                {"name": "expected_output", "value": "Error: Invalid input"},
                                {"name": "program_command", "value": "python3 calculator.py"}
                            ]
                        }
                    ]
                }
            }
        };

        // ===============================================
        // Data: Code Examples
        // ===============================================
        const codeExamples = {
            python: {
                simple: `# Simple Calculator - Python Version
# This calculator adds two numbers from stdin

a = int(input())
b = int(input())
print(a + b)`,
                advanced: `# Advanced Calculator - Python Version
# Supports multiple operations: add, subtract, multiply, divide, power, modulo, sqrt

import sys
import math

def main():
    try:
        operation = input().strip().lower()

        if operation == "sqrt":
            num = float(input())
            if num < 0:
                print("Error: Invalid input")
            else:
                result = int(math.sqrt(num))
                print(result)
            return

        num1 = input().strip()
        num2 = input().strip()

        # Validate inputs are numbers
        try:
            a = int(num1)
            b = int(num2)
        except ValueError:
            print("Error: Invalid input")
            return

        if operation == "add":
            print(a + b)
        elif operation == "subtract":
            print(a - b)
        elif operation == "multiply":
            print(a * b)
        elif operation == "divide":
            if b == 0:
                print("Error: Division by zero")
            else:
                print(a // b)
        elif operation == "power":
            print(a ** b)
        elif operation == "modulo":
            print(a % b)
        else:
            print("Error: Unknown operation")

    except Exception as e:
        print(f"Error: {str(e)}")

if __name__ == "__main__":
    main()`,
                broken: `# Broken Calculator - Python Version (for testing failures)
# This calculator has bugs and will fail some tests

a = int(input())
b = int(input())
# Bug: subtracts instead of adds
print(a - b)`
            },
            java: {
                simple: `// Simple Calculator - Java Version
import java.util.Scanner;

public class Calculator {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        int a = scanner.nextInt();
        int b = scanner.nextInt();
        System.out.println(a + b);
        scanner.close();
    }
}`,
                advanced: `// Advanced Calculator - Java Version
import java.util.Scanner;

public class Calculator {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        try {
            String operation = scanner.nextLine().trim().toLowerCase();

            if (operation.equals("sqrt")) {
                double num = Double.parseDouble(scanner.nextLine().trim());
                if (num < 0) {
                    System.out.println("Error: Invalid input");
                } else {
                    System.out.println((int) Math.sqrt(num));
                }
                scanner.close();
                return;
            }

            String input1 = scanner.nextLine().trim();
            String input2 = scanner.nextLine().trim();

            int a, b;
            try {
                a = Integer.parseInt(input1);
                b = Integer.parseInt(input2);
            } catch (NumberFormatException e) {
                System.out.println("Error: Invalid input");
                scanner.close();
                return;
            }

            switch (operation) {
                case "add": System.out.println(a + b); break;
                case "subtract": System.out.println(a - b); break;
                case "multiply": System.out.println(a * b); break;
                case "divide":
                    if (b == 0) System.out.println("Error: Division by zero");
                    else System.out.println(a / b);
                    break;
                case "power": System.out.println((int) Math.pow(a, b)); break;
                case "modulo": System.out.println(a % b); break;
                default: System.out.println("Error: Unknown operation");
            }
        } catch (Exception e) {
            System.out.println("Error: " + e.getMessage());
        }
        scanner.close();
    }
}`,
                broken: `// Broken Calculator - Java Version
import java.util.Scanner;

public class Calculator {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        int a = scanner.nextInt();
        int b = scanner.nextInt();
        // Bug: subtracts instead of adds
        System.out.println(a - b);
        scanner.close();
    }
}`
            },
            javascript: {
                simple: `// Simple Calculator - JavaScript/Node.js Version
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    terminal: false
});

const lines = [];

rl.on('line', (line) => {
    lines.push(line.trim());
    if (lines.length === 2) {
        const a = parseInt(lines[0]);
        const b = parseInt(lines[1]);
        console.log(a + b);
        rl.close();
    }
});`,
                advanced: `// Advanced Calculator - JavaScript/Node.js Version
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    terminal: false
});

const lines = [];

rl.on('line', (line) => {
    lines.push(line.trim());

    if (lines.length >= 1) {
        const operation = lines[0].toLowerCase();

        if (operation === 'sqrt' && lines.length === 2) {
            const num = parseFloat(lines[1]);
            if (isNaN(num) || num < 0) {
                console.log("Error: Invalid input");
            } else {
                console.log(Math.floor(Math.sqrt(num)));
            }
            rl.close();
            return;
        }

        if (lines.length === 3) {
            const a = parseInt(lines[1]);
            const b = parseInt(lines[2]);

            if (isNaN(a) || isNaN(b)) {
                console.log("Error: Invalid input");
            } else {
                switch (operation) {
                    case 'add': console.log(a + b); break;
                    case 'subtract': console.log(a - b); break;
                    case 'multiply': console.log(a * b); break;
                    case 'divide':
                        if (b === 0) console.log("Error: Division by zero");
                        else console.log(Math.floor(a / b));
                        break;
                    case 'power': console.log(Math.pow(a, b)); break;
                    case 'modulo': console.log(a % b); break;
                    default: console.log("Error: Unknown operation");
                }
            }
            rl.close();
        }
    }
});`,
                broken: `// Broken Calculator - JavaScript/Node.js Version
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
    terminal: false
});

const lines = [];

rl.on('line', (line) => {
    lines.push(line.trim());
    if (lines.length === 2) {
        const a = parseInt(lines[0]);
        const b = parseInt(lines[1]);
        // Bug: subtracts instead of adds
        console.log(a - b);
        rl.close();
    }
});`
            },
            cpp: {
                simple: `// Simple Calculator - C++ Version
#include <iostream>

int main() {
    int a, b;
    std::cin >> a >> b;
    std::cout << a + b << std::endl;
    return 0;
}`,
                advanced: `// Advanced Calculator - C++ Version
#include <iostream>
#include <string>
#include <cmath>
#include <algorithm>

int main() {
    std::string operation;
    std::getline(std::cin, operation);

    std::transform(operation.begin(), operation.end(), operation.begin(), ::tolower);
    operation.erase(0, operation.find_first_not_of(" \\t\\n\\r"));
    operation.erase(operation.find_last_not_of(" \\t\\n\\r") + 1);

    if (operation == "sqrt") {
        std::string numStr;
        std::getline(std::cin, numStr);
        try {
            double num = std::stod(numStr);
            if (num < 0) std::cout << "Error: Invalid input" << std::endl;
            else std::cout << static_cast<int>(std::sqrt(num)) << std::endl;
        } catch (...) {
            std::cout << "Error: Invalid input" << std::endl;
        }
        return 0;
    }

    std::string input1, input2;
    std::getline(std::cin, input1);
    std::getline(std::cin, input2);

    int a, b;
    try {
        a = std::stoi(input1);
        b = std::stoi(input2);
    } catch (...) {
        std::cout << "Error: Invalid input" << std::endl;
        return 0;
    }

    if (operation == "add") std::cout << a + b << std::endl;
    else if (operation == "subtract") std::cout << a - b << std::endl;
    else if (operation == "multiply") std::cout << a * b << std::endl;
    else if (operation == "divide") {
        if (b == 0) std::cout << "Error: Division by zero" << std::endl;
        else std::cout << a / b << std::endl;
    }
    else if (operation == "power") std::cout << static_cast<int>(std::pow(a, b)) << std::endl;
    else if (operation == "modulo") std::cout << a % b << std::endl;
    else std::cout << "Error: Unknown operation" << std::endl;

    return 0;
}`,
                broken: `// Broken Calculator - C++ Version
#include <iostream>

int main() {
    int a, b;
    std::cin >> a >> b;
    // Bug: subtracts instead of adds
    std::cout << a - b << std::endl;
    return 0;
}`
            }
        };

        // Language to file extension mapping
        const languageExtensions = {
            python: '.py',
            java: '.java',
            javascript: '.js',
            cpp: '.cpp'
        };

        // Language to program command mapping
        const programCommands = {
            python: 'python3 calculator.py',
            java: 'java Calculator',
            javascript: 'node calculator.js',
            cpp: './calculator'
        };

        // ===============================================
        // Utility Functions
        // ===============================================
        function getApiUrl() {
            return document.getElementById('api-url').value.replace(/\/$/, '');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();

            const bgColor = {
                'success': 'bg-success',
                'error': 'bg-danger',
                'warning': 'bg-warning',
                'info': 'bg-info'
            }[type] || 'bg-secondary';

            const toastHtml = `
                <div id="${toastId}" class="toast show ${bgColor}" role="alert">
                    <div class="toast-body d-flex align-items-center">
                        <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'} me-2"></i>
                        ${message}
                        <button type="button" class="btn-close btn-close-white ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', toastHtml);

            setTimeout(() => {
                const toast = document.getElementById(toastId);
                if (toast) toast.remove();
            }, 5000);
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            navigator.clipboard.writeText(element.value).then(() => {
                showToast('Copied to clipboard!', 'success');
            });
        }

        function formatJSON() {
            const textarea = document.getElementById('criteria-json');
            try {
                const json = JSON.parse(textarea.value);
                textarea.value = JSON.stringify(json, null, 2);
            } catch (e) {
                showToast('Invalid JSON format', 'error');
            }
        }

        function displayResponse(elementId, data, status = null, time = null) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre class="mb-0 text-light">${JSON.stringify(data, null, 2)}</pre>`;

            if (status !== null) {
                const statusEl = document.getElementById('response-status');
                if (statusEl) {
                    statusEl.textContent = status;
                    statusEl.className = `badge ${status < 400 ? 'bg-success' : 'bg-danger'}`;
                }
            }

            if (time !== null) {
                const timeEl = document.getElementById('response-time');
                if (timeEl) {
                    timeEl.textContent = `${time}ms`;
                }
            }
        }

        // ===============================================
        // API Functions
        // ===============================================
        async function apiRequest(endpoint, method = 'GET', body = null) {
            const url = getApiUrl() + endpoint;
            const startTime = Date.now();

            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(url, options);
                const endTime = Date.now();
                const data = await response.json();

                return {
                    data,
                    status: response.status,
                    time: endTime - startTime,
                    ok: response.ok
                };
            } catch (error) {
                return {
                    data: { error: error.message },
                    status: 0,
                    time: Date.now() - startTime,
                    ok: false
                };
            }
        }

        // ===============================================
        // Configuration Tab Functions
        // ===============================================
        function updateCriteriaJSON() {
            const templateId = document.getElementById('criteria-template').value;
            const language = document.getElementById('config-language').value;

            // Deep clone the template
            const criteria = JSON.parse(JSON.stringify(criteriaTemplates[templateId]));

            // Update program commands based on selected language
            updateProgramCommands(criteria, language);

            document.getElementById('criteria-json').value = JSON.stringify(criteria, null, 2);

            // Update tree visualization
            updateTreeVisualization(criteria);
        }

        function updateProgramCommands(obj, language) {
            if (typeof obj !== 'object' || obj === null) return;

            if (Array.isArray(obj)) {
                obj.forEach(item => updateProgramCommands(item, language));
                return;
            }

            for (const key in obj) {
                if (key === 'parameters' && Array.isArray(obj[key])) {
                    const programCmdParam = obj[key].find(p => p.name === 'program_command');
                    if (programCmdParam) {
                        programCmdParam.value = programCommands[language];
                    }
                }
                updateProgramCommands(obj[key], language);
            }
        }

        function updateTreeVisualization(criteria) {
            const container = document.getElementById('tree-visualization');
            let html = '';

            // Base category
            html += `<div class="tree-node tree-base"> Base (weight: ${criteria.base.weight})</div>`;
            if (criteria.base.subjects) {
                html += renderSubjects(criteria.base.subjects, 1);
            }
            if (criteria.base.tests) {
                html += renderTests(criteria.base.tests, 1);
            }

            // Bonus category
            if (criteria.bonus) {
                html += `<div class="tree-node tree-bonus mt-2"> Bonus (weight: ${criteria.bonus.weight})</div>`;
                if (criteria.bonus.tests) {
                    html += renderTests(criteria.bonus.tests, 1);
                }
            }

            // Penalty category
            if (criteria.penalty) {
                html += `<div class="tree-node tree-penalty mt-2"> Penalty (weight: ${criteria.penalty.weight})</div>`;
                if (criteria.penalty.tests) {
                    html += renderTests(criteria.penalty.tests, 1);
                }
            }

            container.innerHTML = html;
        }

        function renderSubjects(subjects, level) {
            let html = '';
            const indent = '   '.repeat(level);

            subjects.forEach((subject, idx) => {
                const isLast = idx === subjects.length - 1;
                const prefix = isLast ? ' ' : ' ';
                html += `<div class="tree-node tree-subject">${indent}${prefix} ${subject.subject_name} (weight: ${subject.weight})</div>`;

                if (subject.subjects) {
                    html += renderSubjects(subject.subjects, level + 1);
                }
                if (subject.tests) {
                    html += renderTests(subject.tests, level + 1);
                }
            });

            return html;
        }

        function renderTests(tests, level) {
            let html = '';
            const indent = '   '.repeat(level);

            tests.forEach((test, idx) => {
                const isLast = idx === tests.length - 1;
                const prefix = isLast ? ' ' : ' ';
                const inputs = test.parameters?.find(p => p.name === 'inputs')?.value || [];
                const expected = test.parameters?.find(p => p.name === 'expected_output')?.value || '';
                html += `<div class="tree-node tree-test">${indent}${prefix} ${test.name}: [${inputs.join(', ')}]  "${expected}"</div>`;
            });

            return html;
        }

        async function createConfiguration() {
            const btn = event.target;
            btn.classList.add('loading');

            const assignmentId = document.getElementById('config-assignment-id').value;
            const language = document.getElementById('config-language').value;

            let criteria;
            try {
                criteria = JSON.parse(document.getElementById('criteria-json').value);
            } catch (e) {
                showToast('Invalid JSON in criteria configuration', 'error');
                btn.classList.remove('loading');
                return;
            }

            const payload = {
                external_assignment_id: assignmentId,
                template_name: 'input_output',
                criteria_config: criteria,
                language: language
            };

            const result = await apiRequest('/api/v1/configs', 'POST', payload);

            displayResponse('config-response', result.data);

            if (result.ok) {
                showToast('Configuration created successfully!', 'success');
            } else {
                showToast(`Error: ${result.data.detail || 'Failed to create configuration'}`, 'error');
            }

            btn.classList.remove('loading');
        }

        // ===============================================
        // Submit Tab Functions
        // ===============================================
        function loadCodeExample() {
            const language = document.getElementById('submit-language').value;
            const example = document.getElementById('code-example').value;

            // Update filename
            const ext = languageExtensions[language];
            document.getElementById('submit-filename').value = 'calculator' + ext;

            // Load code if not custom
            if (example !== 'custom') {
                document.getElementById('source-code').value = codeExamples[language][example];
            }
        }

        async function submitCode() {
            const btn = event.target;
            btn.classList.add('loading');

            const assignmentId = document.getElementById('submit-assignment-id').value;
            const username = document.getElementById('submit-username').value;
            const userId = document.getElementById('submit-user-id').value;
            const language = document.getElementById('submit-language').value;
            const filename = document.getElementById('submit-filename').value;
            const code = document.getElementById('source-code').value;

            const payload = {
                external_assignment_id: assignmentId,
                external_user_id: userId,
                username: username,
                files: {
                    [filename]: {
                        filename: filename,
                        content: code
                    }
                },
                language: language
            };

            const result = await apiRequest('/api/v1/submissions', 'POST', payload);

            displayResponse('submit-response', result.data);

            if (result.ok) {
                showToast(`Submission created! ID: ${result.data.id}`, 'success');
                // Store submission ID for quick access
                document.getElementById('result-submission-id').value = result.data.id;
            } else {
                showToast(`Error: ${result.data.detail || 'Failed to submit code'}`, 'error');
            }

            btn.classList.remove('loading');
        }

        // ===============================================
        // Results Tab Functions
        // ===============================================
        async function getSubmissionResult() {
            const btn = event.target;
            btn.classList.add('loading');

            const submissionId = document.getElementById('result-submission-id').value;

            const result = await apiRequest(`/api/v1/submissions/${submissionId}`);

            if (result.ok) {
                displayResult(result.data);
            } else {
                document.getElementById('result-display').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        ${result.data.detail || 'Failed to fetch submission'}
                    </div>
                `;
            }

            btn.classList.remove('loading');
        }

        function displayResult(data) {
            const container = document.getElementById('result-display');

            const statusClass = {
                'pending': 'status-pending',
                'processing': 'status-processing',
                'completed': 'status-completed',
                'failed': 'status-failed'
            }[data.status] || 'status-pending';

            let html = `
                <div class="row mb-4">
                    <div class="col-md-4 text-center">
                        <div class="score-display">${data.final_score !== null ? data.final_score.toFixed(1) : '-'}</div>
                        <div class="text-secondary">Final Score</div>
                    </div>
                    <div class="col-md-8">
                        <table class="table table-dark table-sm">
                            <tr>
                                <td class="text-secondary">Submission ID</td>
                                <td>${data.id}</td>
                            </tr>
                            <tr>
                                <td class="text-secondary">Username</td>
                                <td>${data.username}</td>
                            </tr>
                            <tr>
                                <td class="text-secondary">Status</td>
                                <td><span class="status-badge ${statusClass}">${data.status}</span></td>
                            </tr>
                            <tr>
                                <td class="text-secondary">Submitted</td>
                                <td>${new Date(data.submitted_at).toLocaleString()}</td>
                            </tr>
                            ${data.graded_at ? `
                            <tr>
                                <td class="text-secondary">Graded</td>
                                <td>${new Date(data.graded_at).toLocaleString()}</td>
                            </tr>
                            ` : ''}
                        </table>
                    </div>
                </div>
            `;

            if (data.feedback) {
                html += `
                    <div class="card bg-dark mb-3">
                        <div class="card-header">
                            <i class="bi bi-chat-left-text me-2"></i>Feedback
                        </div>
                        <div class="card-body">
                            <pre class="mb-0 text-light">${data.feedback}</pre>
                        </div>
                    </div>
                `;
            }

            if (data.result_tree) {
                html += `
                    <div class="card bg-dark">
                        <div class="card-header">
                            <i class="bi bi-diagram-3 me-2"></i>Result Tree
                        </div>
                        <div class="card-body">
                            <pre class="mb-0 text-light json-viewer">${JSON.stringify(data.result_tree, null, 2)}</pre>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        async function getUserSubmissions() {
            const userId = document.getElementById('result-user-id').value;

            const result = await apiRequest(`/api/v1/submissions/user/${userId}`);

            const container = document.getElementById('recent-submissions');

            if (result.ok && result.data.length > 0) {
                container.innerHTML = result.data.map(sub => `
                    <a href="#" class="list-group-item list-group-item-action bg-dark text-light border-secondary"
                       onclick="loadSubmission(${sub.id}); return false;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>#${sub.id}</strong>
                                <span class="status-badge ${sub.status === 'completed' ? 'status-completed' : sub.status === 'failed' ? 'status-failed' : 'status-pending'} ms-2">${sub.status}</span>
                            </div>
                            <span class="badge bg-primary">${sub.final_score !== null ? sub.final_score.toFixed(1) : '-'}</span>
                        </div>
                        <small class="text-secondary">${new Date(sub.submitted_at).toLocaleString()}</small>
                    </a>
                `).join('');
            } else {
                container.innerHTML = '<div class="text-muted small">No submissions found</div>';
            }
        }

        function loadSubmission(id) {
            document.getElementById('result-submission-id').value = id;
            getSubmissionResult();
        }

        // ===============================================
        // CRUD Tab Functions
        // ===============================================
        async function listConfigurations() {
            const result = await apiRequest('/api/v1/configs');
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function getConfiguration() {
            const configId = document.getElementById('crud-config-id').value;
            const result = await apiRequest(`/api/v1/configs/${configId}`);
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function updateConfiguration() {
            const configId = document.getElementById('crud-config-delete-id').value;
            const result = await apiRequest(`/api/v1/configs/${configId}`, 'PUT', { is_active: true });
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function getSubmission() {
            const submissionId = document.getElementById('crud-submission-id').value;
            const result = await apiRequest(`/api/v1/submissions/${submissionId}`);
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function listUserSubmissionsCrud() {
            const userId = document.getElementById('crud-user-submissions').value;
            const result = await apiRequest(`/api/v1/submissions/user/${userId}`);
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function healthCheck() {
            const result = await apiRequest('/api/v1/health');
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function readinessCheck() {
            const result = await apiRequest('/api/v1/ready');
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        async function listTemplates() {
            const result = await apiRequest('/api/v1/templates');
            displayResponse('crud-response', result.data, result.status, result.time);
        }

        // ===============================================
        // Initialization
        // ===============================================
        async function checkApiStatus() {
            const statusEl = document.getElementById('api-status');
            try {
                const result = await apiRequest('/api/v1/health');
                if (result.ok) {
                    statusEl.textContent = 'Connected';
                    statusEl.parentElement.classList.remove('bg-danger');
                    statusEl.parentElement.classList.add('bg-success');
                } else {
                    statusEl.textContent = 'Error';
                    statusEl.parentElement.classList.remove('bg-success');
                    statusEl.parentElement.classList.add('bg-danger');
                }
            } catch (e) {
                statusEl.textContent = 'Offline';
                statusEl.parentElement.classList.remove('bg-success');
                statusEl.parentElement.classList.add('bg-danger');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial criteria JSON
            updateCriteriaJSON();

            // Load initial code example
            loadCodeExample();

            // Check API status
            checkApiStatus();

            // Add event listeners
            document.getElementById('criteria-template').addEventListener('change', updateCriteriaJSON);
            document.getElementById('config-language').addEventListener('change', updateCriteriaJSON);
            document.getElementById('api-url').addEventListener('change', checkApiStatus);

            // Periodically check API status
            setInterval(checkApiStatus, 30000);
        });
    </script>
</body>
</html>

